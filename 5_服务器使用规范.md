# 服务器使用规范@Team NLP

## *绝对不可触犯的*
1. 禁止将自己的服务器账号和密码泄露给他人。
2. 禁止使用实验室服务器进行挖矿、网络攻击等非法行为。
3. 禁止私自开源、贩卖、传播和宣传实验室知识产权的代码、专利、文献等资料。

### 计算
1. 允许使用单机单卡、单机多卡、多机多卡进行训练，只要你有足够多的机或足够多的卡。
2. 选择合适的显卡运行项目。
   1. 4090：算力高，单卡24G。
   2. A6000：单卡48G，但比4090略慢，适合部署和训练大模型。
3. 尽可能不要用DP(DataParallel)，选择DDP(DistributedDataParallel)。两者的区别：详见[传送门](https://zhuanlan.zhihu.com/p/356967195)。
4. 如发生僵尸程序导致显存被无故占用，请优先自查后台进程并自行杀死进程。管理员强制kill你的进程有概率导致服务器异常（下下策）。

### 存储
1. 不要将代码、数据集、环境、模型等任何开发相关文件放置在home目录下。
2. 如果服务器同时有固态硬盘和机械硬盘，建议合理放置你的文件：
   1. 固态硬盘：读写速度快，但一旦发生损坏，数据无法修复找回。
   2. 机械硬盘：读写速度一般，但比较安全。
   3. 一般服务器上的硬盘都是以几十T为单位的，但总体上，机械硬盘空间更大。
   4. **无论用什么盘，养成异地备份的习惯才是正道！！！**

### 网络
1. 一般我们称服务器之间的网络为内网，服务器与校园网之间的网络为外网。因此，无论何时我们都需要使用校园网或学校VPN连接服务器。
2. 通常，服务器不具备科学上网的能力。如需从google下载数据或模型，请先下载至你的电脑上，再传输到服务器。
3. 有至少两种从本地传输文件到服务器的方法：
   1. 直接拖拽文件到vscode左侧文件夹内：看不到上传进度，适合小文件。不建议传大文件时使用，传到一半断网你是不知道文件有没有损坏的。
   2. scp命令行：可以看到每个文件的上传进度。
```bash
# 传输文件
scp [本地文件路径] [服务器用户名]@[服务器ip]:[目标路径]
# 例
scp /Users/luminjun/Downloads/qwen.py great79@58.199.161.165:/server24/LLM

# 传输文件夹
scp -r [本地文件夹路径] [服务器用户名]@[服务器ip]:[目标路径]
# 例
scp -r /Users/luminjun/Downloads/Qwen1.5-32B-Chat great79@58.199.161.165:/server24/LLM
```
4. 允许并鼓励将程序封装为应用，但禁止占用重要端口，也不要占用实验室固定用途的端口，详见：[Network Port Occupation](https://github.com/orgs/GREAT-NLPKE/projects/8)。如需长期占用某端口，请向管理员登记。
5. 允许通过爬虫（只要对方网站不ban你）、调用api（只要你能调）等手段获取网络数据。建议不要高频率的爬虫，人为加一些sleep()函数。

### 开发
1. 如遇使用conda时，报错没有权限，可让管理员帮你`chmod 777`一下权限。
2. 鼓励使用docker封装开发环境。
3. 不要盲目升级vscode，太新的版本可能会有不可预知的问题。
4. 在编程时如遇编辑器丢失代码补全或函数提醒等功能。请尽可能打开具体的工作区，或尝试重新安装不同版本的python插件或pylance插件。
